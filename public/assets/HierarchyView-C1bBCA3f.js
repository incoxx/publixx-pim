import{n as z,r as b,G as L,q as i,t as m,F as A,z as H,v as o,S as F,B as C,x as c,D as N,y as M,j as E,V as B,A as V,H as j,I as J,o as Z}from"./vendor-B0bC02TM.js";import{e as P,c as h,f as D,b as q,d as G}from"./index-B_89pp-1.js";import{C as K}from"./chevron-down-CSxCUBwz.js";import{C as R}from"./chevron-right-BtFY1BQ2.js";import{E as Q}from"./ellipsis-DAI6l6F-.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=P("FolderOpenIcon",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=P("FolderIcon",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),I={list(e={}){return h.get("/hierarchies",{params:D(e)})},create(e){return h.post("/hierarchies",e)},update(e,r){return h.put(`/hierarchies/${e}`,r)},delete(e){return h.delete(`/hierarchies/${e}`)},getTree(e,r={}){return h.get(`/hierarchies/${e}/tree`,{params:D(r)})},getNodes(e,r={}){return h.get(`/hierarchies/${e}/nodes`,{params:D(r)})},createNode(e,r){return h.post(`/hierarchies/${e}/nodes`,r)},updateNode(e,r){return h.put(`/hierarchy-nodes/${e}`,r)},deleteNode(e){return h.delete(`/hierarchy-nodes/${e}`)},moveNode(e,r){return h.put(`/hierarchy-nodes/${e}/move`,r)},getNodeAttributes(e,r={}){return h.get(`/hierarchy-nodes/${e}/attributes`,{params:D(r)})},assignNodeAttribute(e,r){return h.post(`/hierarchy-nodes/${e}/attributes`,r)},updateNodeAttributeAssignment(e,r){return h.put(`/node-attribute-assignments/${e}`,r)},removeNodeAttributeAssignment(e){return h.delete(`/node-attribute-assignments/${e}`)},bulkSortAssignments(e){return h.put("/node-attribute-assignments/bulk-sort",e)}},X=z("hierarchies",()=>{const e=b([]),r=b(null),a=b([]),g=b(null),f=b(new Set),x=b(!1),k=b(null);async function S(s={}){var y,v;x.value=!0;try{const{data:w}=await I.list(s);e.value=w.data||w}catch(w){k.value=((v=(y=w.response)==null?void 0:y.data)==null?void 0:v.title)||"Fehler"}finally{x.value=!1}}async function p(s,y={}){var v,w;x.value=!0;try{const{data:T}=await I.getTree(s,y);a.value=T.data||T,r.value=e.value.find(O=>O.id===s)||null}catch(T){k.value=((w=(v=T.response)==null?void 0:v.data)==null?void 0:w.title)||"Fehler"}finally{x.value=!1}}async function u(s,y){const{data:v}=await I.createNode(s,y);return v.data||v}async function $(s,y){const{data:v}=await I.updateNode(s,y);return v.data||v}async function t(s){await I.deleteNode(s)}async function d(s,y,v){await I.moveNode(s,{parent_node_id:y,sort_order:v})}function _(s){g.value=s}function n(s){f.value.has(s)?f.value.delete(s):f.value.add(s)}function l(s){return f.value.has(s)}return{hierarchies:e,currentHierarchy:r,tree:a,selectedNode:g,expandedNodes:f,loading:x,error:k,fetchHierarchies:S,fetchTree:p,createNode:u,updateNode:$,deleteNode:t,moveNode:d,selectNode:_,toggleExpanded:n,isExpanded:l}}),Y=["draggable","onClick","onDragstart","onDrop"],ee=["onClick"],te={key:1,class:"w-5 shrink-0"},re={class:"truncate flex-1"},ae={key:4,class:"text-[10px] text-[var(--color-text-tertiary)] bg-[var(--color-bg)] px-1.5 rounded-full"},se=["onClick"],oe={__name:"PimTree",props:{nodes:{type:Array,default:()=>[]},selectedId:{type:String,default:null},expandedIds:{type:Set,default:()=>new Set},level:{type:Number,default:0},draggable:{type:Boolean,default:!0}},emits:["select","toggle","create","delete","move","context-menu"],setup(e,{emit:r}){const a=e,g=r;function f(t){return a.expandedIds.has(t.id)}function x(t){return t.children&&t.children.length>0}function k(t){g("select",t)}function S(t){g("toggle",t.id)}function p(t,d){a.draggable&&(t.dataTransfer.setData("text/plain",JSON.stringify({nodeId:d.id})),t.dataTransfer.effectAllowed="move")}function u(t,d){t.preventDefault();try{const _=JSON.parse(t.dataTransfer.getData("text/plain"));_.nodeId!==d.id&&g("move",_.nodeId,d.id)}catch{}}function $(t){t.preventDefault(),t.dataTransfer.dropEffect="move"}return(t,d)=>{const _=L("PimTree",!0);return i(),m("ul",{class:V(e.level===0?"space-y-0.5":"")},[(i(!0),m(A,null,H(e.nodes,n=>(i(),m("li",{key:n.id},[o("div",{class:V(["group flex items-center gap-1 px-2 py-[5px] rounded-md cursor-pointer transition-colors text-[13px]",e.selectedId===n.id?"bg-[color-mix(in_srgb,var(--color-accent)_10%,transparent)] text-[var(--color-accent)]":"text-[var(--color-text-primary)] hover:bg-[var(--color-bg)]"]),style:B({paddingLeft:e.level*20+8+"px"}),draggable:e.draggable,onClick:l=>k(n),onDragstart:l=>p(l,n),onDrop:l=>u(l,n),onDragover:$},[x(n)?(i(),m("button",{key:0,class:"p-0.5 rounded hover:bg-[var(--color-border)] shrink-0",onClick:F(l=>S(n),["stop"])},[f(n)?(i(),C(c(K),{key:0,class:"w-3.5 h-3.5","stroke-width":2})):(i(),C(c(R),{key:1,class:"w-3.5 h-3.5","stroke-width":2}))],8,ee)):(i(),m("span",te)),f(n)&&x(n)?(i(),C(c(U),{key:2,class:"w-4 h-4 shrink-0 text-[var(--color-accent)]","stroke-width":1.75})):(i(),C(c(W),{key:3,class:"w-4 h-4 shrink-0 text-[var(--color-text-tertiary)]","stroke-width":1.75})),o("span",re,N(n.name_de||n.name||n.label),1),n.product_count!=null?(i(),m("span",ae,N(n.product_count),1)):M("",!0),o("button",{class:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-[var(--color-border)] transition-opacity shrink-0",onClick:F(l=>t.$emit("context-menu",l,n),["stop"])},[E(c(Q),{class:"w-3.5 h-3.5 text-[var(--color-text-tertiary)]"})],8,se)],46,Y),E(J,{name:"fade"},{default:j(()=>[x(n)&&f(n)?(i(),C(_,{key:0,nodes:n.children,selectedId:e.selectedId,expandedIds:e.expandedIds,level:e.level+1,draggable:e.draggable,onSelect:d[0]||(d[0]=l=>t.$emit("select",l)),onToggle:d[1]||(d[1]=l=>t.$emit("toggle",l)),onCreate:d[2]||(d[2]=l=>t.$emit("create",l)),onDelete:d[3]||(d[3]=l=>t.$emit("delete",l)),onMove:d[4]||(d[4]=(l,s)=>t.$emit("move",l,s)),onContextMenu:d[5]||(d[5]=(l,s)=>t.$emit("context-menu",l,s))},null,8,["nodes","selectedId","expandedIds","level","draggable"])):M("",!0)]),_:2},1024)]))),128))],2)}}},ne={class:"flex gap-4 h-[calc(100vh-140px)]"},le={class:"w-[320px] shrink-0 pim-card flex flex-col overflow-hidden"},de={class:"flex items-center justify-between px-4 py-3 border-b border-[var(--color-border)]"},ie={class:"text-sm font-semibold text-[var(--color-text-primary)]"},ce={class:"pim-btn pim-btn-ghost p-1"},ue={class:"px-3 py-2 border-b border-[var(--color-border)]"},he=["value"],pe=["value"],ve={class:"flex-1 overflow-y-auto p-2"},me={key:0,class:"space-y-2 p-2"},fe={class:"flex-1 pim-card overflow-y-auto"},ge={key:0,class:"p-6 space-y-4"},xe={class:"text-base font-semibold text-[var(--color-text-primary)]"},ye={class:"grid grid-cols-2 gap-4 text-sm"},be={class:"font-mono text-xs"},ke={key:1,class:"flex items-center justify-center h-full"},Ce={__name:"HierarchyView",setup(e){const{t:r}=q(),a=X(),g=b(null);async function f(p){g.value=p,await a.fetchTree(p)}function x(p){a.selectNode(p)}function k(p){a.toggleExpanded(p)}async function S(p,u){await a.moveNode(p,u,0),g.value&&await a.fetchTree(g.value)}return Z(async()=>{await a.fetchHierarchies(),a.hierarchies.length>0&&await f(a.hierarchies[0].id)}),(p,u)=>{var $;return i(),m("div",ne,[o("div",le,[o("div",de,[o("h3",ie,N(c(r)("hierarchy.title")),1),o("button",ce,[E(c(G),{class:"w-4 h-4","stroke-width":2})])]),o("div",ue,[o("select",{class:"pim-input text-xs",value:g.value,onChange:u[0]||(u[0]=t=>f(t.target.value))},[(i(!0),m(A,null,H(c(a).hierarchies,t=>(i(),m("option",{key:t.id,value:t.id},N(t.name_de||t.name),9,pe))),128))],40,he)]),o("div",ve,[c(a).loading?(i(),m("div",me,[(i(),m(A,null,H(6,t=>o("div",{key:t,class:"pim-skeleton h-6 rounded",style:B({width:50+Math.random()*50+"%"})},null,4)),64))])):(i(),C(oe,{key:1,nodes:c(a).tree,selectedId:($=c(a).selectedNode)==null?void 0:$.id,expandedIds:c(a).expandedNodes,onSelect:x,onToggle:k,onMove:S},null,8,["nodes","selectedId","expandedIds"]))])]),o("div",fe,[c(a).selectedNode?(i(),m("div",ge,[o("h3",xe,N(c(a).selectedNode.name_de||c(a).selectedNode.name),1),o("div",ye,[o("div",null,[u[1]||(u[1]=o("span",{class:"text-[12px] text-[var(--color-text-tertiary)]"},"Code",-1)),o("p",be,N(c(a).selectedNode.code||"—"),1)]),o("div",null,[u[2]||(u[2]=o("span",{class:"text-[12px] text-[var(--color-text-tertiary)]"},"Produkte",-1)),o("p",null,N(c(a).selectedNode.product_count??0),1)])]),u[3]||(u[3]=o("div",{class:"border-t border-[var(--color-border)] pt-4"},[o("h4",{class:"text-sm font-medium text-[var(--color-text-secondary)] mb-3"},"Zugeordnete Attribute"),o("p",{class:"text-xs text-[var(--color-text-tertiary)]"},"Attribute werden hier angezeigt und verwaltet.")],-1))])):(i(),m("div",ke,[...u[4]||(u[4]=[o("p",{class:"text-sm text-[var(--color-text-tertiary)]"},"Knoten auswählen",-1)])]))])])}}};export{Ce as default};
